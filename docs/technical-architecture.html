<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Technical Architecture - The Birthmark Standard Foundation</title>
    <link rel="icon" type="image/svg+xml" href="Birthmark_logo_trimmed.svg">
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header>
        <div class="container">
            <div class="header-content">
                <div class="logo-section">
                    <div class="logo">
                        <img src="./Birthmark_logo_transparent.svg" alt="Birthmark Standard Foundation Logo">
                    </div>
                    <h1><span class="the-prefix">The</span><span class="org-name">Birthmark Standard Foundation</span></h1>
                </div>
                <nav>
                    <a href="verify.html" style="background: var(--accent-blue); padding: 0.5rem 1rem; border-radius: 4px;">Verify Image</a>
                    <a href="index.html">Home</a>
                    <div class="dropdown">
                        <a href="#" class="dropdown-toggle">How It Works ▾</a>
                        <div class="dropdown-menu">
                            <a href="technical-architecture.html">Technical Architecture</a>
                            <a href="privacy-design.html">Privacy Design</a>
                            <a href="governance.html">Governance Plan</a>
                            <a href="investigation-framework.html">Investigation Framework</a>
                        </div>
                    </div>
                    <div class="dropdown">
                        <a href="#" class="dropdown-toggle">The People ▾</a>
                        <div class="dropdown-menu">
                            <a href="contact.html">Contact</a>
                            <a href="https://www.linkedin.com/company/birthmarkstandard/" class="external-link">LinkedIn ↗</a>
                            <a href="https://github.com/Birthmark-Standard/Birthmark" class="external-link">GitHub ↗</a>
                        </div>
                    </div>
                </nav>
            </div>
        </div>
    </header>

    <section class="hero" style="padding: 3rem 0;">
        <div class="container">
            <h2>Technical Architecture</h2>
            <p style="max-width: 800px; margin: 0 auto;">How authenticated photographs travel from camera sensor through manufacturer validation to permanent blockchain storage—surviving all metadata loss.</p>
        </div>
    </section>

    <!-- SECTION 1: ON CAMERA -->
    <section class="technical-section">
        <div class="container">
            <h2>1. On Camera: Capture and Authentication Packet Creation</h2>
            <p class="section-intro">When you press the shutter, the camera creates cryptographic proof linking the image to physical hardware—generating a complete authentication packet ready for submission.</p>

            <div class="content-block">
                <h3>Hardware Root of Trust</h3>
                <p>Every camera sensor has unique manufacturing imperfections creating a Non-Uniformity Correction (NUC) map—as unique as a fingerprint. At manufacturing, the camera stores SHA-256(NUC_map) in its Secure Element (tamper-resistant chip). This becomes the unforgeable hardware identity.</p>

                <p style="margin-top: 1rem;"><strong>For smartphones without factory calibration:</strong> On first launch, the app captures PRNU (sensor noise pattern), uses it as entropy to generate an ECDSA keypair, stores the private key in the device secure enclave (Android StrongBox, iOS Secure Enclave), then permanently discards the PRNU pattern. The keypair becomes permanent device identity.</p>
            </div>

            <div class="content-block">
                <h3>Parallel Processing at Capture</h3>
                <p>Two simultaneous processes occur the instant you press the shutter:</p>

                <div class="diagram-box">
                    <h4>Process A: Image Hashing</h4>
                    <div class="code-block">
Sensor captures → Raw Bayer data
        ↓
[DMA splits to two paths]
        ↓
    ┌───┴────┐
    ↓        ↓
Secure    Image Signal
Element   Processor (ISP)
    ↓        ↓
Hash raw  Process to JPEG
(SHA-256) Save to storage
    ↓        ↓
Raw hash  Hash processed
          (SHA-256)
    ↓        ↓
Raw hash  Processed hash
                    </div>
                    <p><strong>Result:</strong> Two hashes—raw sensor data (unmodified) and processed image (what you share).</p>
                </div>

                <div class="diagram-box" style="margin-top: 1.5rem;">
                    <h4>Process B: Camera Token Generation</h4>
                    <div class="code-block">
Secure Element:
1. Retrieve stored NUC hash
2. Randomly select 1 of 3 assigned key tables
3. Randomly select 1 of 1,000 keys from that table
4. Encrypt NUC hash with AES-256-GCM
        ↓
Camera Token created:
  • Encrypted NUC hash (ciphertext)
  • Authentication tag (tamper detection)
  • Nonce (unique encryption value)
  • Key reference (table_id + key_index)
                    </div>
                    <p><strong>Result:</strong> Encrypted proof only the manufacturer can validate—without seeing your image.</p>
                </div>
            </div>

            <div class="content-block">
                <h3>Authentication Packet Assembly</h3>
                <p>The camera assembles a complete submission packet (~411 bytes total) containing three components bound by cryptographic signatures:</p>

                <div class="diagram-box">
                    <h4>Component 1: Birthmark Record</h4>
                    <div class="code-block">
{
  "image_hashes": [
    {
      "hash": "a9d1dbb063ffd40ed3da020e...",
      "modification_level": 0,  // Raw
      "parent_hash": null
    },
    {
      "hash": "29d6c8498815c58cb274cb48...",
      "modification_level": 1,  // Validated processed
      "parent_hash": "a9d1dbb063ffd40ed3da020e..."
    }
  ],
  "metadata_hashes": {  // Optional, disabled by default
    "timestamp_hash": "...",
    "location_hash": "...",
    "owner_hash": "..."
  }
}
                    </div>
                </div>

                <div class="diagram-box" style="margin-top: 1.5rem;">
                    <h4>Component 2: Manufacturer Certificate</h4>
                    <div class="code-block">
{
  "validator_id": "CANON_001",
  "encrypted_token": {
    "ciphertext": "2f358ac4a60fe672...",
    "auth_tag": "6acb56f767fc4f1f...",
    "nonce": "52428f0a..."
  },
  "key_reference": {
    "table_id": 1203,
    "key_index": 452
  },
  "record_hash": "SHA-256(birthmark_record)"
}
                    </div>
                    <p><strong>Critical:</strong> Manufacturer certificate contains NO image hashes. Manufacturer validates camera without seeing what you photographed.</p>
                </div>

                <div class="diagram-box" style="margin-top: 1.5rem;">
                    <h4>Component 3: Camera Signature</h4>
                    <div class="code-block">
camera_signature = ECDSA_sign(
  private_key_in_secure_element,
  SHA-256(manufacturer_certificate)
)
                    </div>
                    <p><strong>Purpose:</strong> Binds the certificate to this specific camera, preventing packet tampering or component mixing attacks.</p>
                </div>
            </div>

            <div class="content-block">
                <h3>Server Selection and Submission</h3>
                <p>The camera queries a registry (https://registry.birthmark.org/servers.json) updated every 24 hours, selects three geographically diverse servers (Americas, Europe, Asia-Pacific) excluding the busiest 25%, and submits the authentication packet to two randomly selected servers from this set.</p>

                <p style="margin-top: 1rem;"><strong>Why two servers?</strong> Dual-approval protocol requires validation from two independent servers before blockchain posting, preventing single-server fraud.</p>
            </div>
        </div>
    </section>

    <!-- SECTION 2: BIRTHMARK INFRASTRUCTURE -->
    <section class="technical-section" style="background: var(--light-blue);">
        <div class="container">
            <h2>2. Birthmark Infrastructure: Validation and Blockchain Posting</h2>
            <p class="section-intro">The authentication packet travels through multiple independent validators—manufacturer authority, dual submission servers, and blockchain validators—before becoming a permanent record.</p>

            <div class="content-block">
                <h3>Submission Server Processing</h3>
                <p>When a submission server receives the authentication packet, it executes a strict validation and routing protocol:</p>

                <div class="diagram-box">
                    <h4>Validation Flow</h4>
                    <div class="code-block">
1. Receive authentication packet
        ↓
2. Verify camera signature
   (Checks: signature valid? certificate hash matches?)
        ↓
3. Extract manufacturer certificate
        ↓
4. Route to manufacturer authority
   POST /validate {encrypted_token, key_reference}
        ↓
5. Wait for manufacturer response
        ↓
    ┌───┴────┐
    ↓        ↓
  PASS     FAIL
    ↓        ↓
Continue  Reject
to step 6  packet
        ↓
6. Coordinate with second server
   (Dual-approval requirement)
        ↓
7. Both servers sign birthmark record
        ↓
8. Submit to blockchain validators
                    </div>
                </div>

                <p style="margin-top: 1.5rem;"><strong>Critical separation:</strong> Submission servers see image hashes but cannot decrypt camera tokens. Manufacturers see encrypted tokens but never receive image hashes. No single party has complete information.</p>
            </div>

            <div class="content-block">
                <h3>Manufacturer Authority Validation</h3>
                <p>The manufacturer receives only the encrypted token and key reference—no image hashes, timestamps, or server identifiers:</p>

                <div class="diagram-box">
                    <h4>Manufacturer Validation Process</h4>
                    <div class="code-block">
Receive: {encrypted_token, key_reference}
        ↓
1. Look up decryption key
   (table_id: 1203, key_index: 452)
        ↓
2. Decrypt token with AES-256-GCM
   → Decrypted NUC hash
        ↓
3. Query production database
   "Is this NUC hash from a legitimate camera?"
        ↓
4. Verify authentication tag
   "Has token been tampered with?"
        ↓
5. Return response:
   PASS: "Legitimate camera"
   FAIL: "Unknown or tampered token"
                    </div>
                </div>

                <p style="margin-top: 1.5rem;"><strong>Stateless validation:</strong> Manufacturer does not log device identifiers or validation timestamps. Even with database access, adversaries learn only the population of legitimate devices—not which devices authenticated which images or when cameras were active.</p>
            </div>

            <div class="content-block">
                <h3>Dual-Approval Protocol</h3>
                <p>Before blockchain submission, the system enforces dual-approval to prevent single-server fraud:</p>

                <div class="diagram-box">
                    <div class="code-block">
Server A validates → Receives PASS from manufacturer
Server B validates → Receives PASS from manufacturer
        ↓
Both servers create validation proof:
{
  "server_id": "node-eu-1",
  "server_signature": ECDSA_sign(record_hash),
  "record_hash": "SHA-256(birthmark_record)",
  "validator_signature": manufacturer_PASS_signature
}
        ↓
Blockchain validators verify:
  ✓ Two different server_ids
  ✓ Both server signatures valid
  ✓ Both validator signatures match
  ✓ Same record_hash from both servers
        ↓
If all valid → Post birthmark record to blockchain
If any fail → Reject submission
                    </div>
                </div>

                <p style="margin-top: 1.5rem;"><strong>Security property:</strong> Single compromised server cannot forge manufacturer approval (signatures bind to server_id). Manufacturer cannot post directly to blockchain (requires two independent server approvals).</p>
            </div>

            <div class="content-block">
                <h3>Blockchain Posting and Storage</h3>
                <p>After dual-approval validation, only the birthmark record (153 bytes) is posted to the blockchain. The manufacturer certificate and validation proofs (~350 bytes) are verified then discarded:</p>

                <div class="diagram-box">
                    <h4>What Gets Stored On-Chain (153 bytes)</h4>
                    <div class="code-block">
{
  "image_hash": "a9d1dbb063ffd40ed3da020e...",
  "modification_level": 0,
  "parent_hash": null,
  "metadata_hashes": {...},  // If provided
  "posting_server_ids": "node-eu-1/node-us-3",
  "posting_timestamp": 1706572800,  // Rounded to 10-min intervals
  "block_number": 12345
}
                    </div>
                </div>

                <p style="margin-top: 1.5rem;"><strong>Storage efficiency:</strong> At 1 million authentications per day, blockchain grows by only 56GB/year. Validator node costs remain under $200-350/year, making operation sustainable for nonprofit journalism organizations.</p>

                <p style="margin-top: 1rem;"><strong>Consensus:</strong> GRANDPA (GHOST-based Recursive Ancestor Deriving Prefix Agreement) requires 67% validator agreement for block finality. Minimum 4 validators (tolerates 1 Byzantine fault), recommended 10+ validators (tolerates 3 Byzantine faults).</p>
            </div>

            <div class="content-block">
                <h3>ISP Deviation Validation (For Edited Images)</h3>
                <p>When photographers edit images in software (Lightroom, Photoshop), the editing application can create authenticated records with modification_level=2 by including deviation validation data:</p>

                <div class="diagram-box">
                    <div class="code-block">
Software extracts:
  • Operation list (e.g., "Exposure +1.5, Crop 16:9")
  • 100 random 64x64 pixel patches from original
  • Applies reported operations to patches
  • Compares actual edited result to simulation
        ↓
Deviation = % of pixels where RGB distance > threshold
        ↓
Standard edits (exposure, white balance, crop):
  Typical deviation: 8-12%
  Classification: "Validated" (modification_level=2)
        ↓
Content modification (clone stamp, object removal):
  Typical deviation: >40%
  Classification: "Content Modified"
                    </div>
                </div>

                <p style="margin-top: 1.5rem;"><strong>Key distinction:</strong> Deviation measures difference from the expected result given reported operations, not difference from original. Standard workflows produce low deviation because the validation service can accurately replicate the adjustments. Content alteration tools cannot simulate results because modifications are unpredictable from operation parameters alone.</p>
            </div>
        </div>
    </section>

    <!-- SECTION 3: PUBLIC VERIFICATION -->
    <section class="technical-section">
        <div class="container">
            <h2>3. Public Verification: Anyone Can Verify</h2>
            <p class="section-intro">Once an image hash is recorded on the blockchain, anyone can verify authenticity—no account, no subscription, no gatekeepers required.</p>

            <div class="content-block">
                <h3>Verification Process</h3>
                <p>Public verification works through hash-based lookup with zero knowledge of photographer identity or device:</p>

                <div class="diagram-box">
                    <h4>Complete Verification Flow</h4>
                    <div class="code-block">
User has image (JPEG, PNG, HEIC, etc.)
        ↓
Upload to web verifier OR hash locally
        ↓
Calculate SHA-256 hash of image bytes
        ↓
Query blockchain:
  GET /verify/{image_hash}
        ↓
    ┌───┴────┐
    ↓        ↓
  Found   Not Found
    ↓        ↓
Return   Return "No record"
record   (Unverified)
    ↓
Display:
  • Modification level (Raw/Validated/Modified)
  • Timestamp (server processing time)
  • Parent hash (if edited image)
  • Provenance chain (full edit history)
                    </div>
                </div>

                <p style="margin-top: 1.5rem;"><strong>Privacy guarantee:</strong> Blockchain query reveals nothing about photographer identity, camera serial number, capture location, or manufacturer. Query is stateless—blockchain doesn't know who verified the image.</p>
            </div>

            <div class="content-block">
                <h3>Modification Level Interpretation</h3>

                <div class="diagram-box">
                    <h4>Level 0: "Validated Raw"</h4>
                    <p><strong>Meaning:</strong> Raw sensor data from verified camera—no processing beyond sensor readout.</p>
                    <p><strong>Use case:</strong> Maximum authenticity for forensic analysis and evidentiary purposes.</p>
                </div>

                <div class="diagram-box" style="margin-top: 1rem;">
                    <h4>Level 1: "Validated"</h4>
                    <p><strong>Meaning:</strong> Processed image (JPEG/HEIC) from verified camera with standard in-camera white balance, sharpening, and compression.</p>
                    <p><strong>Use case:</strong> Standard authentication for photojournalism and social sharing.</p>
                </div>

                <div class="diagram-box" style="margin-top: 1rem;">
                    <h4>Level 2: "Modified"</h4>
                    <p><strong>Meaning:</strong> Edited in software (Lightroom, Photoshop) but links back to validated original via parent_hash.</p>
                    <p><strong>Use case:</strong> Edited photos maintaining chain of custody to authenticated capture.</p>
                </div>

                <div class="diagram-box" style="margin-top: 1rem;">
                    <h4>Not Found</h4>
                    <p><strong>Meaning:</strong> No blockchain record exists. Either never authenticated or not yet propagated.</p>
                    <p><strong>Use case:</strong> Unknown provenance. Treat with appropriate skepticism.</p>
                </div>
            </div>

            <div class="content-block">
                <h3>Provenance Chain Verification</h3>
                <p>For edited images (modification_level=2), verifiers can trace the complete edit history back to the original capture:</p>

                <div class="diagram-box">
                    <div class="code-block">
Current image (edited crop)
  hash: 4f2a3b...
  modification_level: 2
  parent_hash: 8c5d9e...
        ↓
Query parent (8c5d9e...)
  modification_level: 2
  parent_hash: a9d1db...
        ↓
Query parent (a9d1db...)
  modification_level: 0 (raw)
  parent_hash: null
        ↓
Verified chain: Raw → Edit → Crop
                    </div>
                </div>

                <p style="margin-top: 1.5rem;"><strong>Result:</strong> Complete transparency about editing workflow while maintaining cryptographic proof that edits derive from authenticated hardware capture, not AI generation.</p>
            </div>

            <div class="content-block">
                <h3>Metadata Independence</h3>
                <p><strong>The fundamental advantage:</strong> Because authentication records are stored on an independent blockchain rather than embedded in image files, verification survives all forms of metadata loss:</p>

                <ul class="technical-list">
                    <li>Social media compression and format conversion (95% of C2PA credentials lost)</li>
                    <li>Email attachment processing and size reduction</li>
                    <li>Screenshot capture and re-saving</li>
                    <li>Platform-specific image processing (Instagram filters, Twitter recompression)</li>
                    <li>Format conversion (JPEG → PNG → WebP)</li>
                    <li>Cropping, rotation, and resolution scaling</li>
                </ul>

                <p style="margin-top: 1.5rem;"><strong>Limitation:</strong> If pixel values change (filters, edits, significant compression artifacts), the hash changes and verification requires querying the parent hash. This is why parent_hash linking is critical for edited images.</p>
            </div>

            <div class="content-block">
                <h3>Verification Tools</h3>
                <p>Multiple verification paths ensure accessibility:</p>

                <ul class="technical-list">
                    <li><strong>Web verifier:</strong> Upload image to verify (https://birthmarkstandard.org/verify)</li>
                    <li><strong>Browser extension:</strong> Right-click any image to verify in-place</li>
                    <li><strong>Command-line tool:</strong> Local hashing and blockchain query for privacy-conscious users</li>
                    <li><strong>GIMP plugin:</strong> Integrated verification within photo editing workflow</li>
                    <li><strong>API access:</strong> Direct blockchain queries for developers and automated systems</li>
                </ul>

                <p style="margin-top: 1.5rem;"><strong>All tools are open-source:</strong> Anyone can audit verification logic or run their own verification infrastructure.</p>
            </div>
        </div>
    </section>

    <footer id="about">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>The Birthmark Standard Foundation</h3>
                    <p>Creating hardware-backed photo authentication infrastructure on a custom blockchain operated by trusted institutions as a public good.</p>
                </div>
                <div class="footer-section">
                    <h3>Resources</h3>
                    <a href="index.html">Home</a>
                    <a href="technical-architecture.html">Technical Architecture</a>
                    <a href="privacy-design.html">Privacy Design</a>
                    <a href="governance.html">Governance</a>
                    <a href="contact.html">Contact</a>
                    <a href="https://github.com/Birthmark-Standard/Birthmark">GitHub Repository</a>
                </div>
                <div class="footer-section">
                    <h3>Contact</h3>
                    <a href="mailto:contact@birthmarkstandard.org">contact@birthmarkstandard.org</a>
                    <a href="https://www.linkedin.com/company/birthmarkstandard/" class="external-link">LinkedIn ↗</a>
                    <p style="margin-top: 1rem;">The Birthmark Standard Foundation<br>501(c)(3) in formation</p>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 The Birthmark Standard Foundation. Dual license: AGPL-3.0 (blockchain) / Apache-2.0 (tools).</p>
            </div>
        </div>
    </footer>

    <style>
        /* Dropdown menu styles */
        .dropdown {
            position: relative;
            display: inline-block;
        }

        .dropdown-toggle {
            cursor: pointer;
        }

        .dropdown-menu {
            display: none;
            position: absolute;
            background-color: white;
            min-width: 180px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            border-radius: 4px;
            z-index: 1000;
            top: 100%;
            left: 0;
            margin-top: 0;
            padding-top: 0.25rem;
        }

        .dropdown-menu a {
            display: block;
            padding: 0.5rem 0.75rem;
            text-decoration: none;
            color: #333;
            font-size: 0.9rem;
            transition: background-color 0.2s;
            white-space: nowrap;
        }

        .dropdown-menu a:hover {
            background-color: var(--light-blue);
            color: #333;
        }

        .dropdown:hover .dropdown-menu {
            display: block;
        }

        .external-link {
            color: var(--accent-blue);
        }

        .external-link:hover {
            color: var(--accent-blue);
            background-color: var(--light-blue);
        }

        @media (max-width: 768px) {
            .dropdown-toggle {
                pointer-events: auto;
            }

            .dropdown-menu {
                position: static;
                box-shadow: none;
                margin-top: 0.5rem;
                padding-top: 0;
                background-color: rgba(255, 255, 255, 0.95);
            }

            .dropdown.active .dropdown-menu {
                display: block;
            }

            .dropdown:hover .dropdown-menu {
                display: none;
            }
        }

        .section-intro {
            font-size: 1.1rem;
            color: var(--gray-text);
            margin-bottom: 2rem;
        }
    </style>

    <script>
        // Mobile dropdown toggle functionality
        document.addEventListener('DOMContentLoaded', function() {
            if (window.innerWidth <= 768) {
                const dropdowns = document.querySelectorAll('.dropdown');

                dropdowns.forEach(dropdown => {
                    const toggle = dropdown.querySelector('.dropdown-toggle');

                    toggle.addEventListener('click', function(e) {
                        e.preventDefault();

                        dropdowns.forEach(other => {
                            if (other !== dropdown) {
                                other.classList.remove('active');
                            }
                        });

                        dropdown.classList.toggle('active');
                    });
                });

                document.addEventListener('click', function(e) {
                    if (!e.target.closest('.dropdown')) {
                        dropdowns.forEach(dropdown => {
                            dropdown.classList.remove('active');
                        });
                    }
                });
            }
        });
    </script>
</body>
</html>
